#!/usr/bin/env python3
"""
Project CLI - Command Launcher for Agentive Projects
=====================================================

Simple memorable command interface for common project operations.

Usage:
    ./project linearsync     - Sync tasks to Linear
    ./project sync           - Alias for linearsync
    ./project help           - Show help
"""

import subprocess
import sys
from pathlib import Path


def main():
    """Launch project commands."""
    # Get the project directory
    project_dir = Path(__file__).parent

    # Use venv Python if available, otherwise system Python
    venv_python = project_dir / "venv" / "bin" / "python3"
    if not venv_python.exists():
        venv_python = project_dir / ".venv" / "bin" / "python3"
    python_cmd = str(venv_python) if venv_python.exists() else "python3"

    # Show help if no arguments
    if len(sys.argv) == 1:
        print_help()
        sys.exit(0)

    command = sys.argv[1].lower()

    # Handle commands
    if command in ["linearsync", "sync", "linear"]:
        # Linear sync command
        print("üöÄ Syncing tasks to Linear...")
        sync_args = sys.argv[2:] if len(sys.argv) > 2 else []
        cmd = [
            python_cmd,
            str(project_dir / "scripts" / "sync_tasks_to_linear.py"),
        ] + sync_args

    elif command in ["help", "-h", "--help"]:
        print_help()
        sys.exit(0)

    elif command == "version":
        print("Project CLI v1.0.0")
        print("Part of Agentive Starter Kit")
        sys.exit(0)

    else:
        print(f"‚ùå Unknown command: {command}")
        print("Run './project help' for available commands.")
        sys.exit(1)

    # Run the command from project directory
    try:
        result = subprocess.run(cmd, cwd=project_dir)
        sys.exit(result.returncode)
    except subprocess.CalledProcessError as e:
        print(f"‚ùå Error running command: {e}")
        sys.exit(1)
    except KeyboardInterrupt:
        print("\n‚ö†Ô∏è  Operation cancelled by user")
        sys.exit(0)
    except FileNotFoundError:
        print(f"‚ùå Python not found at: {python_cmd}")
        print("   Make sure you have a virtual environment set up:")
        print("   python3 -m venv venv && source venv/bin/activate")
        sys.exit(1)


def print_help():
    """Print help message."""
    print("""
Project CLI - Agentive Starter Kit
==================================

Usage: ./project <command> [options]

Commands:
  linearsync, sync   Sync task files to Linear
  help               Show this help message
  version            Show version information

Examples:
  ./project linearsync           Sync all tasks to Linear
  ./project sync                 Alias for linearsync

Setup:
  1. Create a virtual environment:
     python3 -m venv venv && source venv/bin/activate

  2. Install dependencies:
     pip install -e ".[dev,linear]"

  3. Configure Linear API:
     cp .env.template .env
     # Edit .env and add your LINEAR_API_KEY

  4. Sync tasks:
     ./project linearsync

For more information, see README.md
""")


if __name__ == "__main__":
    main()
